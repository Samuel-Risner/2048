(()=>{"use strict";const e={animation:{durationMS:750},field:{size:4},style:{widthPerUnitPx:100}};function*t(e,t,l){for(let n=0;n<l;n++)yield[e[n][t],t,n];return null}function*l(l){for(let n=0;n<e.field.size;n++)for(let i=0;i<e.field.size+1;i++)yield()=>t(l,n,i);return null}function*n(t,l,n){for(let i=e.field.size-1;i>e.field.size-n;i--)yield[t[i][l],l,i];return null}function*i(t){for(let l=0;l<e.field.size;l++)for(let i=1;i<e.field.size+2;i++)yield()=>n(t,l,i);return null}function*o(e,t,l){for(let n=0;n<l;n++)yield[e[t][n],n,t];return null}function*s(t){for(let l=0;l<t.length;l++)for(let n=1;n<e.field.size+1;n++)yield()=>o(t,l,n);return null}function*r(t,l,n){for(let i=e.field.size-1;i>e.field.size-n;i--)yield[t[l][i],i,l];return null}function*a(t){for(let l=0;l<e.field.size;l++)for(let n=1;n<e.field.size+2;n++)yield()=>r(t,l,n);return null}function d(t,l,n,i){t.style.top=i*e.style.widthPerUnitPx+"px",t.style.left=n*e.style.widthPerUnitPx+"px"}class u{x;y;positionElement;colorElement;textElement;value;hasMerged;constructor(t,l,n){var i;this.x=t,this.y=l,this.positionElement=document.createElement("div"),this.colorElement=document.createElement("div"),this.textElement=document.createElement("div"),(i=this.positionElement).style.position="absolute",i.style.width=`${e.style.widthPerUnitPx}px`,i.style.height=`${e.style.widthPerUnitPx}px`,i.style.display="flex",d(this.positionElement,0,t,l),function(e){e.style.backgroundColor="white",e.style.width="90%",e.style.height="90%",e.style.display="flex",e.style.margin="auto",e.style.borderRadius="10%"}(this.colorElement),function(t){t.style.display="flex",t.style.margin="auto",t.style.fontSize=e.style.widthPerUnitPx/3+"px"}(this.textElement),this.setValue(Math.random()<.1?4:2),n.appendChild(this.positionElement),this.positionElement.appendChild(this.colorElement),this.colorElement.appendChild(this.textElement),this.hasMerged=!1}setValue(e){switch(this.value=e,this.textElement.textContent=String(e),e){case 2:this.colorElement.style.backgroundColor="#FCD0A1";break;case 4:this.colorElement.style.backgroundColor="#B1B695";break;case 8:this.colorElement.style.backgroundColor="#A690A4";break;case 16:this.colorElement.style.backgroundColor="#5E4B56";break;case 32:this.colorElement.style.backgroundColor="#AFD2E9";break;case 64:this.colorElement.style.backgroundColor="#F42272";break;case 128:this.colorElement.style.backgroundColor="#F397D6";break;case 256:this.colorElement.style.backgroundColor="#D7B8F3";break;case 512:this.colorElement.style.backgroundColor="#B8B8F3";break;case 2048:this.colorElement.style.backgroundColor="#deb841";break;default:this.colorElement.style.backgroundColor="white"}}getValue(){return this.value}getX(){return this.x}getY(){return this.y}getHasMerged(){return this.hasMerged}setHasMerged(e){this.hasMerged=e}remove(){this.positionElement.remove()}setAnimation(t,l,n,i){const o=this.positionElement.animate([{left:this.x*e.style.widthPerUnitPx+"px",top:this.y*e.style.widthPerUnitPx+"px"},{left:t*e.style.widthPerUnitPx+"px",top:l*e.style.widthPerUnitPx+"px"}],{duration:e.animation.durationMS,iterations:1});this.x=t,this.y=l,o.onfinish=()=>{o.cancel(),i?.remove(),this.setValue(n),d(this.positionElement,0,this.x,this.y)}}}const h=document.getElementById("root");function c(){const t=window.innerWidth,l=window.innerHeight;if(t>l){const n=l/(e.field.size*e.style.widthPerUnitPx);h.style.transform=`scale(${n})`,h.style.left=(t-e.field.size*e.style.widthPerUnitPx*n)/2+"px",h.style.top="0px"}else{const n=t/(e.field.size*e.style.widthPerUnitPx);h.style.transform=`scale(${n})`,h.style.left="0px",h.style.top=(l-e.field.size*e.style.widthPerUnitPx*n)/2+"px"}}window.onload=()=>{c(),window.onresize=c},h.style.width=e.field.size*e.style.widthPerUnitPx+"px",h.style.height=e.field.size*e.style.widthPerUnitPx+"px",h.style.position="relative",h.style.transformOrigin="0% 0% 0px";let f=!1;const y=[];for(let e=0;e<4;e++){y.push([]);for(let t=0;t<4;t++)y[e][t]=null}function g(){const e=[];for(let t=0;t<y.length;t++)for(let l=0;l<y[t].length;l++)null===y[t][l]&&e.push([l,t]);if(0===e.length)return!1;const[t,l]=e[Math.floor(Math.random()*e.length)];return y[l][t]=new u(t,l,h),!0}let m=!1;const p={up:!0,down:!0,left:!0,right:!0};function x(t){for(const l of t)for(let t=0;t<e.field.size;t++){const e=l();let t=e.next().value;if(null===t)continue;let[n,i,o]=t,s=n;for(const[t,l,r]of e)if(null!==t)if(null!==n){{let e=t.getValue();if(null!==s&&s.getValue()===e&&!s.getHasMerged()){t.setAnimation(s.getX(),s.getY(),2*e,s),y[s.getY()][s.getX()]=t,y[r][l]=null,t.setHasMerged(!0),s.setHasMerged(!0),m=!0;continue}}n=t,s=t}else{let e=t.getValue();if(null!==s&&s.getValue()===e&&!s.getHasMerged()){t.setAnimation(s.getX(),s.getY(),2*e,s),y[s.getY()][s.getX()]=t,y[r][l]=null,t.setHasMerged(!0),s.setHasMerged(!0),m=!0;continue}t.setAnimation(i,o,e,null),y[o][i]=t,y[r][l]=null,m=!0}else{if(null===n)continue;i=l,o=r,n=t}}return m?(function(){for(const e of y)for(const t of e)null!==t&&t.setHasMerged(!1)}(),m=!1,setTimeout((()=>{g(),f=!1}),e.animation.durationMS),!0):(f=!1,m=!1,!1)}function w(){if(console.log(p),!(p.up||p.down||p.left||p.right)){alert("Defeat!");for(let e=0;e<y.length;e++)for(let t=0;t<y[e].length;t++)null!==y[e][t]&&(y[e][t].remove(),y[e][t]=null);return p.up=!0,p.down=!0,p.left=!0,p.right=!0,g(),void g()}}document.addEventListener("keydown",(e=>{if(!f){switch(f=!0,e.code){case"ArrowUp":x(l(y))||(p.up=!1);break;case"ArrowDown":x(i(y))||(p.down=!1);break;case"ArrowLeft":x(s(y))||(p.left=!1);break;case"ArrowRight":x(a(y))||(p.right=!1);break;default:return void(f=!1)}w()}}));let E=0,P=0;h.ontouchstart=e=>{e.preventDefault(),E=e.touches[0].clientX,P=e.touches[0].clientY},h.ontouchmove=e=>{e.preventDefault()},h.ontouchend=e=>{if(e.preventDefault(),f)return;f=!0;const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;Math.abs(E-t)<Math.abs(P-n)?P>n?x(l(y))||(p.up=!1):x(i(y))||(p.down=!1):E>t?x(s(y))||(p.left=!1):x(a(y))||(p.right=!1),w()},g(),g(),h.hidden=!1})();
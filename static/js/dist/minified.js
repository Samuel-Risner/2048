(()=>{"use strict";const e={durationMS:2e3},t={size:4},n={size:100};function*l(e,t,n){for(let l=0;l<n;l++)yield[e[l][t],t,l];return null}function*i(e,n,l){for(let i=t.size-1;i>t.size-l;i--)yield[e[i][n],n,i];return null}function*s(e,t,n){for(let l=0;l<n;l++)yield[e[t][l],l,t];return null}function*o(e,n,l){for(let i=t.size-1;i>t.size-l;i--)yield[e[n][i],i,n];return null}function r(e,t,l,i){e.style.backgroundColor=t,e.style.top=i*n.size+"px",e.style.left=l*n.size+"px"}class u{x;y;element;value;hasMerged;constructor(e,t,l){var i;this.x=e,this.y=t,this.element=document.createElement("div"),(i=this.element).style.position="absolute",i.style.width=`${n.size}px`,i.style.height=`${n.size}px`,r(this.element,"red",e,t),l.appendChild(this.element),this.value=2,this.element.textContent=String(this.value),this.hasMerged=!1}getValue(){return this.value}getX(){return this.x}getY(){return this.y}getHasMerged(){return this.hasMerged}setHasMerged(e){this.hasMerged=e}remove(){this.element.remove()}setAnimation(e,t,l,i){const s=this.element.animate([{left:this.x*n.size+"px",top:this.y*n.size+"px"},{left:e*n.size+"px",top:t*n.size+"px"}],{duration:2e3,iterations:1});this.x=e,this.y=t,s.onfinish=()=>{s.cancel(),i?.remove(),this.value=l,this.element.textContent=String(this.value),r(this.element,"aquamarine",this.x,this.y)}}}const f=document.getElementById("root");let a=!1;const c=[];for(let e=0;e<4;e++){c.push([]);for(let t=0;t<4;t++)c[e][t]=null}function h(){const e=[];for(let t=0;t<c.length;t++)for(let n=0;n<c[t].length;n++)null===c[t][n]&&e.push([n,t]);if(0===e.length)return!1;const[t,n]=e[Math.floor(Math.random()*e.length)];return c[n][t]=new u(t,n,f),!0}function d(n){for(const e of n)for(let n=0;n<t.size;n++){const t=e();let n=t.next().value;if(null===n)continue;let[l,i,s]=n,o=l;for(const[e,n,r]of t)if(null!==e)if(null!==l){{let t=e.getValue();if(null!==o&&o.getValue()===t&&!o.getHasMerged()){e.setAnimation(o.getX(),o.getY(),2*t,o),c[o.getY()][o.getX()]=e,c[r][n]=null,e.setHasMerged(!0),o.setHasMerged(!0);continue}}l=e,o=e}else{let t=e.getValue();if(null!==o&&o.getValue()===t&&!o.getHasMerged()){e.setAnimation(o.getX(),o.getY(),2*t,o),c[o.getY()][o.getX()]=e,c[r][n]=null,e.setHasMerged(!0),o.setHasMerged(!0);continue}e.setAnimation(i,s,t,null),c[s][i]=e,c[r][n]=null}else{if(null===l)continue;i=n,s=r,l=e}}!function(){for(const e of c)for(const t of e)null!==t&&t.setHasMerged(!1);for(const e of c)for(const t of e)null!==t&&console.log(t.getHasMerged())}(),setTimeout((()=>{h(),a=!1}),e.durationMS)}h(),h(),document.addEventListener("keydown",(e=>{if(!a)switch(a=!0,e.code){case"ArrowUp":return void d(function*(e){for(let n=0;n<t.size;n++)for(let i=0;i<t.size+1;i++)yield()=>l(e,n,i);return null}(c));case"ArrowDown":return void d(function*(e){for(let n=0;n<t.size;n++)for(let l=1;l<t.size+2;l++)yield()=>i(e,n,l);return null}(c));case"ArrowLeft":return void d(function*(e){for(let n=0;n<e.length;n++)for(let l=1;l<t.size+1;l++)yield()=>s(e,n,l);return null}(c));case"ArrowRight":return void d(function*(e){for(let n=0;n<t.size;n++)for(let l=1;l<t.size+2;l++)yield()=>o(e,n,l);return null}(c));default:return void(a=!1)}}))})();
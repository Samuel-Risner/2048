(()=>{"use strict";const e={durationMS:2e3},t={size:4},n={widthPerUnitPx:100};function*i(e,t,n){for(let i=0;i<n;i++)yield[e[i][t],t,i];return null}function*l(e,n,i){for(let l=t.size-1;l>t.size-i;l--)yield[e[l][n],n,l];return null}function*r(e,t,n){for(let i=0;i<n;i++)yield[e[t][i],i,t];return null}function*s(e,n,i){for(let l=t.size-1;l>t.size-i;l--)yield[e[n][l],l,n];return null}function o(e,t,i,l){e.style.backgroundColor=t,e.style.top=l*n.widthPerUnitPx+"px",e.style.left=i*n.widthPerUnitPx+"px"}class u{x;y;element;value;hasMerged;constructor(e,t,i){var l;this.x=e,this.y=t,this.element=document.createElement("div"),(l=this.element).style.position="absolute",l.style.width=`${n.widthPerUnitPx}px`,l.style.height=`${n.widthPerUnitPx}px`,o(this.element,"red",e,t),this.setValue(2),i.appendChild(this.element),this.hasMerged=!1}setValue(e){this.value=e,this.element.textContent=String(e)}getValue(){return this.value}getX(){return this.x}getY(){return this.y}getHasMerged(){return this.hasMerged}setHasMerged(e){this.hasMerged=e}remove(){this.element.remove()}setAnimation(t,i,l,r){const s=this.element.animate([{left:this.x*n.widthPerUnitPx+"px",top:this.y*n.widthPerUnitPx+"px"},{left:t*n.widthPerUnitPx+"px",top:i*n.widthPerUnitPx+"px"}],{duration:e.durationMS,iterations:1});this.x=t,this.y=i,s.onfinish=()=>{s.cancel(),r?.remove(),this.setValue(l),o(this.element,"aquamarine",this.x,this.y)}}}const d=document.getElementById("root");function h(){d.style.transform=`scale(${Math.min(window.innerWidth,window.innerHeight)/(t.size*n.widthPerUnitPx)})`}window.onload=()=>{h(),window.onresize=h},d.style.width=t.size*n.widthPerUnitPx+"px",d.style.height=t.size*n.widthPerUnitPx+"px",d.style.position="relative",d.style.transformOrigin="0% 0% 0px";let a=!1;const f=[];for(let e=0;e<4;e++){f.push([]);for(let t=0;t<4;t++)f[e][t]=null}function c(){const e=[];for(let t=0;t<f.length;t++)for(let n=0;n<f[t].length;n++)null===f[t][n]&&e.push([n,t]);if(0===e.length)return!1;const[t,n]=e[Math.floor(Math.random()*e.length)];return f[n][t]=new u(t,n,d),!0}function g(n){for(const e of n)for(let n=0;n<t.size;n++){const t=e();let n=t.next().value;if(null===n)continue;let[i,l,r]=n,s=i;for(const[e,n,o]of t)if(null!==e)if(null!==i){{let t=e.getValue();if(null!==s&&s.getValue()===t&&!s.getHasMerged()){e.setAnimation(s.getX(),s.getY(),2*t,s),f[s.getY()][s.getX()]=e,f[o][n]=null,e.setHasMerged(!0),s.setHasMerged(!0);continue}}i=e,s=e}else{let t=e.getValue();if(null!==s&&s.getValue()===t&&!s.getHasMerged()){e.setAnimation(s.getX(),s.getY(),2*t,s),f[s.getY()][s.getX()]=e,f[o][n]=null,e.setHasMerged(!0),s.setHasMerged(!0);continue}e.setAnimation(l,r,t,null),f[r][l]=e,f[o][n]=null}else{if(null===i)continue;l=n,r=o,i=e}}!function(){for(const e of f)for(const t of e)null!==t&&t.setHasMerged(!1)}(),setTimeout((()=>{c(),a=!1}),e.durationMS)}document.addEventListener("keydown",(e=>{if(!a)switch(a=!0,e.code){case"ArrowUp":return void g(function*(e){for(let n=0;n<t.size;n++)for(let l=0;l<t.size+1;l++)yield()=>i(e,n,l);return null}(f));case"ArrowDown":return void g(function*(e){for(let n=0;n<t.size;n++)for(let i=1;i<t.size+2;i++)yield()=>l(e,n,i);return null}(f));case"ArrowLeft":return void g(function*(e){for(let n=0;n<e.length;n++)for(let i=1;i<t.size+1;i++)yield()=>r(e,n,i);return null}(f));case"ArrowRight":return void g(function*(e){for(let n=0;n<t.size;n++)for(let i=1;i<t.size+2;i++)yield()=>s(e,n,i);return null}(f));default:return void(a=!1)}})),c(),c(),d.hidden=!1})();
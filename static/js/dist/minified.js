(()=>{"use strict";const e={animation:{durationMS:750},field:{size:4},style:{widthPerUnitPx:100}};function*t(e,t,l){for(let i=0;i<l;i++)yield[e[i][t],t,i];return null}function*l(l){for(let i=0;i<e.field.size;i++)for(let n=0;n<e.field.size+1;n++)yield()=>t(l,i,n);return null}function*i(t,l,i){for(let n=e.field.size-1;n>e.field.size-i;n--)yield[t[n][l],l,n];return null}function*n(t){for(let l=0;l<e.field.size;l++)for(let n=1;n<e.field.size+2;n++)yield()=>i(t,l,n);return null}function*o(e,t,l){for(let i=0;i<l;i++)yield[e[t][i],i,t];return null}function*s(t){for(let l=0;l<t.length;l++)for(let i=1;i<e.field.size+1;i++)yield()=>o(t,l,i);return null}function*r(t,l,i){for(let n=e.field.size-1;n>e.field.size-i;n--)yield[t[l][n],n,l];return null}function*a(t){for(let l=0;l<e.field.size;l++)for(let i=1;i<e.field.size+2;i++)yield()=>r(t,l,i);return null}function d(t,l,i,n){t.style.top=n*e.style.widthPerUnitPx+"px",t.style.left=i*e.style.widthPerUnitPx+"px"}class u{x;y;positionElement;colorElement;textElement;value;hasMerged;constructor(t,l,i){var n;this.x=t,this.y=l,this.positionElement=document.createElement("div"),this.colorElement=document.createElement("div"),this.textElement=document.createElement("div"),(n=this.positionElement).style.position="absolute",n.style.width=`${e.style.widthPerUnitPx}px`,n.style.height=`${e.style.widthPerUnitPx}px`,n.style.display="flex",d(this.positionElement,0,t,l),function(e){e.style.backgroundColor="white",e.style.width="90%",e.style.height="90%",e.style.display="flex",e.style.margin="auto",e.style.borderRadius="10%"}(this.colorElement),function(t){t.style.display="flex",t.style.margin="auto",t.style.fontSize=e.style.widthPerUnitPx/3+"px"}(this.textElement),this.setValue(Math.random()<.5?2:4),i.appendChild(this.positionElement),this.positionElement.appendChild(this.colorElement),this.colorElement.appendChild(this.textElement),this.hasMerged=!1}setValue(e){switch(this.value=e,this.textElement.textContent=String(e),e){case 2:this.colorElement.style.backgroundColor="#FCD0A1";break;case 4:this.colorElement.style.backgroundColor="#B1B695";break;case 8:this.colorElement.style.backgroundColor="#A690A4";break;case 16:this.colorElement.style.backgroundColor="#5E4B56";break;case 32:this.colorElement.style.backgroundColor="#AFD2E9";break;case 64:this.colorElement.style.backgroundColor="#F42272";break;case 128:this.colorElement.style.backgroundColor="#F397D6";break;case 256:this.colorElement.style.backgroundColor="#D7B8F3";break;case 512:this.colorElement.style.backgroundColor="#B8B8F3";break;case 2048:this.colorElement.style.backgroundColor="#deb841";break;default:this.colorElement.style.backgroundColor="white"}}getValue(){return this.value}getX(){return this.x}getY(){return this.y}getHasMerged(){return this.hasMerged}setHasMerged(e){this.hasMerged=e}remove(){this.positionElement.remove()}setAnimation(t,l,i,n){const o=this.positionElement.animate([{left:this.x*e.style.widthPerUnitPx+"px",top:this.y*e.style.widthPerUnitPx+"px"},{left:t*e.style.widthPerUnitPx+"px",top:l*e.style.widthPerUnitPx+"px"}],{duration:e.animation.durationMS,iterations:1});this.x=t,this.y=l,o.onfinish=()=>{o.cancel(),n?.remove(),this.setValue(i),d(this.positionElement,0,this.x,this.y)}}}const c=document.getElementById("root");function h(){const t=window.innerWidth,l=window.innerHeight;if(t>l){const i=l/(e.field.size*e.style.widthPerUnitPx);c.style.transform=`scale(${i})`,c.style.left=(t-e.field.size*e.style.widthPerUnitPx*i)/2+"px",c.style.top="0px"}else{const i=t/(e.field.size*e.style.widthPerUnitPx);c.style.transform=`scale(${i})`,c.style.left="0px",c.style.top=(l-e.field.size*e.style.widthPerUnitPx*i)/2+"px"}}window.onload=()=>{h(),window.onresize=h},c.style.width=e.field.size*e.style.widthPerUnitPx+"px",c.style.height=e.field.size*e.style.widthPerUnitPx+"px",c.style.position="relative",c.style.transformOrigin="0% 0% 0px";let f=!1;const y=[];for(let e=0;e<4;e++){y.push([]);for(let t=0;t<4;t++)y[e][t]=null}function g(){const e=[];for(let t=0;t<y.length;t++)for(let l=0;l<y[t].length;l++)null===y[t][l]&&e.push([l,t]);if(0===e.length)return!1;const[t,l]=e[Math.floor(Math.random()*e.length)];return y[l][t]=new u(t,l,c),!0}function m(t){for(const l of t)for(let t=0;t<e.field.size;t++){const e=l();let t=e.next().value;if(null===t)continue;let[i,n,o]=t,s=i;for(const[t,l,r]of e)if(null!==t)if(null!==i){{let e=t.getValue();if(null!==s&&s.getValue()===e&&!s.getHasMerged()){t.setAnimation(s.getX(),s.getY(),2*e,s),y[s.getY()][s.getX()]=t,y[r][l]=null,t.setHasMerged(!0),s.setHasMerged(!0);continue}}i=t,s=t}else{let e=t.getValue();if(null!==s&&s.getValue()===e&&!s.getHasMerged()){t.setAnimation(s.getX(),s.getY(),2*e,s),y[s.getY()][s.getX()]=t,y[r][l]=null,t.setHasMerged(!0),s.setHasMerged(!0);continue}t.setAnimation(n,o,e,null),y[o][n]=t,y[r][l]=null}else{if(null===i)continue;n=l,o=r,i=t}}!function(){for(const e of y)for(const t of e)null!==t&&t.setHasMerged(!1)}(),setTimeout((()=>{g(),f=!1}),e.animation.durationMS)}document.addEventListener("keydown",(e=>{if(!f)switch(f=!0,e.code){case"ArrowUp":return void m(l(y));case"ArrowDown":return void m(n(y));case"ArrowLeft":return void m(s(y));case"ArrowRight":return void m(a(y));default:return void(f=!1)}}));let x=0,p=0;c.ontouchstart=e=>{e.preventDefault(),x=e.touches[0].clientX,p=e.touches[0].clientY},c.ontouchmove=e=>{e.preventDefault()},c.ontouchend=e=>{if(e.preventDefault(),f)return;f=!0;const t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY;m(Math.abs(x-t)<Math.abs(p-i)?p>i?l(y):n(y):x>t?s(y):a(y))},g(),g(),c.hidden=!1})();